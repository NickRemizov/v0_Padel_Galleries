# ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° Galeries

## ğŸ—ï¸ ĞĞ±Ñ‰Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

ĞŸÑ€Ğ¾ĞµĞºÑ‚ ÑĞ¾ÑÑ‚Ğ¾Ğ¸Ñ‚ Ğ¸Ğ· Ğ´Ğ²ÑƒÑ… Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ñ… Ñ‡Ğ°ÑÑ‚ĞµĞ¹:

1. **Next.js Ñ„Ñ€Ğ¾Ğ½Ñ‚ĞµĞ½Ğ´** - Ğ²ĞµĞ±-Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Ğ¸ API Ñ€Ğ¾ÑƒÑ‚Ñ‹
2. **FastAPI Ğ±ÑĞºĞµĞ½Ğ´** - Ñ€Ğ°ÑĞ¿Ğ¾Ğ·Ğ½Ğ°Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ»Ğ¸Ñ† Ğ¸ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Next.js Frontend (Vercel)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ ĞŸÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğµ    â”‚  â”‚ ĞĞ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ â”‚  â”‚ API Routes   â”‚      â”‚
â”‚  â”‚ Ğ³Ğ°Ğ»ĞµÑ€ĞµĞ¸      â”‚  â”‚              â”‚  â”‚ (Proxy)      â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â–¼             â–¼             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Supabase    â”‚  â”‚ Vercel Blob  â”‚  â”‚   FastAPI    â”‚
    â”‚  PostgreSQL  â”‚  â”‚   Storage    â”‚  â”‚   Backend    â”‚
    â”‚              â”‚  â”‚              â”‚  â”‚  (Hetzner)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¹

```
galeries/
â”œâ”€â”€ app/                          # Next.js App Router
â”‚   â”œâ”€â”€ [galleryId]/             # ĞŸÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğµ Ğ³Ğ°Ğ»ĞµÑ€ĞµĞ¸ (Ğ´Ğ¸Ğ½Ğ°Ğ¼Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ñ€Ğ¾ÑƒÑ‚)
â”‚   â”‚   â””â”€â”€ page.tsx             # Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ğ³Ğ°Ğ»ĞµÑ€ĞµĞ¸ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹
â”‚   â”œâ”€â”€ admin/                   # ĞĞ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ
â”‚   â”‚   â”œâ”€â”€ page.tsx             # Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ğ°Ğ´Ğ¼Ğ¸Ğ½ĞºĞ¸
â”‚   â”‚   â”œâ”€â”€ login/               # Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ğ²Ñ…Ğ¾Ğ´Ğ°
â”‚   â”‚   â””â”€â”€ auth/                # Callback Ğ´Ğ»Ñ OAuth
â”‚   â”œâ”€â”€ api/                     # API Routes (Next.js)
â”‚   â”‚   â””â”€â”€ admin/               # ĞĞ´Ğ¼Ğ¸Ğ½ API endpoints
â”‚   â”œâ”€â”€ layout.tsx               # ĞšĞ¾Ñ€Ğ½ĞµĞ²Ğ¾Ğ¹ layout
â”‚   â””â”€â”€ globals.css              # Ğ“Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ ÑÑ‚Ğ¸Ğ»Ğ¸
â”‚
â”œâ”€â”€ components/                   # React ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹
â”‚   â”œâ”€â”€ admin/                   # ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸
â”‚   â”‚   â”œâ”€â”€ galleries-manager.tsx           # Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ³Ğ°Ğ»ĞµÑ€ĞµÑĞ¼Ğ¸
â”‚   â”‚   â”œâ”€â”€ people-manager.tsx              # Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ»ÑĞ´ÑŒĞ¼Ğ¸
â”‚   â”‚   â”œâ”€â”€ gallery-images-manager.tsx      # Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ„Ğ¾Ñ‚Ğ¾
â”‚   â”‚   â”œâ”€â”€ face-tagging-dialog.tsx         # Ğ¢ĞµĞ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ»Ğ¸Ñ†
â”‚   â”‚   â”œâ”€â”€ auto-recognition-dialog.tsx     # ĞĞ²Ñ‚Ğ¾Ñ€Ğ°ÑĞ¿Ğ¾Ğ·Ğ½Ğ°Ğ²Ğ°Ğ½Ğ¸Ğµ
â”‚   â”‚   â”œâ”€â”€ unknown-faces-review-dialog.tsx # ĞšĞ»Ğ°ÑÑ‚ĞµÑ€Ñ‹ Ğ½ĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ñ‹Ñ…
â”‚   â”‚   â”œâ”€â”€ person-gallery-dialog.tsx       # Ğ“Ğ°Ğ»ĞµÑ€ĞµÑ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ°
â”‚   â”‚   â”œâ”€â”€ face-training-manager.tsx       # ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ñ€Ğ°ÑĞ¿Ğ¾Ğ·Ğ½Ğ°Ğ²Ğ°Ğ½Ğ¸Ñ
â”‚   â”‚   â””â”€â”€ database-integrity-checker.tsx  # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ†ĞµĞ»Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ‘Ğ”
â”‚   â””â”€â”€ ui/                      # shadcn/ui ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹
â”‚
â”œâ”€â”€ lib/                         # Ğ£Ñ‚Ğ¸Ğ»Ğ¸Ñ‚Ñ‹ Ğ¸ Ñ…ĞµĞ»Ğ¿ĞµÑ€Ñ‹
â”‚   â”œâ”€â”€ auth/                    # ĞÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ
â”‚   â”‚   â”œâ”€â”€ client.ts            # Supabase ĞºĞ»Ğ¸ĞµĞ½Ñ‚ (Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€)
â”‚   â”‚   â”œâ”€â”€ server.ts            # Supabase ĞºĞ»Ğ¸ĞµĞ½Ñ‚ (ÑĞµÑ€Ğ²ĞµÑ€)
â”‚   â”‚   â””â”€â”€ serverGuard.ts       # Middleware Ğ´Ğ»Ñ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ñ‹ Ñ€Ğ¾ÑƒÑ‚Ğ¾Ğ²
â”‚   â””â”€â”€ utils.ts                 # ĞĞ±Ñ‰Ğ¸Ğµ ÑƒÑ‚Ğ¸Ğ»Ğ¸Ñ‚Ñ‹
â”‚
â”œâ”€â”€ python/                      # FastAPI Backend
â”‚   â”œâ”€â”€ main.py                  # Ğ“Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ» FastAPI
â”‚   â”œâ”€â”€ routers/                 # API Ñ€Ğ¾ÑƒÑ‚ĞµÑ€Ñ‹
â”‚   â”‚   â”œâ”€â”€ recognition.py       # Ğ Ğ°ÑĞ¿Ğ¾Ğ·Ğ½Ğ°Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ»Ğ¸Ñ†
â”‚   â”‚   â”œâ”€â”€ training.py          # ĞĞ±ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸
â”‚   â”‚   â””â”€â”€ config.py            # ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
â”‚   â”œâ”€â”€ services/                # Ğ‘Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°
â”‚   â”‚   â”œâ”€â”€ face_recognition.py  # Ğ›Ğ¾Ğ³Ğ¸ĞºĞ° Ñ€Ğ°ÑĞ¿Ğ¾Ğ·Ğ½Ğ°Ğ²Ğ°Ğ½Ğ¸Ñ
â”‚   â”‚   â”œâ”€â”€ supabase_client.py   # Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ° Ñ Ğ‘Ğ”
â”‚   â”‚   â””â”€â”€ clustering.py        # ĞšĞ»Ğ°ÑÑ‚ĞµÑ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ»Ğ¸Ñ†
â”‚   â”œâ”€â”€ models/                  # Pydantic Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸
â”‚   â”‚   â””â”€â”€ schemas.py           # Ğ¡Ñ…ĞµĞ¼Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
â”‚   â””â”€â”€ requirements.txt         # Python Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸
â”‚
â”œâ”€â”€ scripts/                     # SQL ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ñ‹
â”‚   â”œâ”€â”€ 001_create_tables.sql    # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†
â”‚   â””â”€â”€ 002_add_organizers.sql   # ĞĞ°Ñ‡Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
â”‚
â””â”€â”€ public/                      # Ğ¡Ñ‚Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹
```

## ğŸ”„ ĞŸĞ¾Ñ‚Ğ¾Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### 1. Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ñ„Ğ¾Ñ‚Ğ¾Ğ³Ñ€Ğ°Ñ„Ğ¸Ğ¹

```
ĞĞ´Ğ¼Ğ¸Ğ½ â†’ Upload â†’ Vercel Blob â†’ URL ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ÑÑ Ğ² Supabase
                                      â†“
                              gallery_images Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°
```

### 2. Ğ Ğ°ÑĞ¿Ğ¾Ğ·Ğ½Ğ°Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ»Ğ¸Ñ†

```
ĞĞ´Ğ¼Ğ¸Ğ½ â†’ Ğ—Ğ°Ğ¿ÑƒÑĞº Ñ€Ğ°ÑĞ¿Ğ¾Ğ·Ğ½Ğ°Ğ²Ğ°Ğ½Ğ¸Ñ â†’ Next.js API â†’ FastAPI
                                                â†“
                                    InsightFace Ğ´ĞµÑ‚ĞµĞºÑ†Ğ¸Ñ
                                                â†“
                                    Ğ˜Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ğµ ÑĞ¼Ğ±ĞµĞ´Ğ´Ğ¸Ğ½Ğ³Ğ¾Ğ²
                                                â†“
                                    HNSWLIB Ğ¿Ğ¾Ğ¸ÑĞº Ğ¿Ğ¾Ñ…Ğ¾Ğ¶Ğ¸Ñ…
                                                â†“
                                    Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ² Supabase
                                    (face_descriptors Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°)
```

### 3. ĞšĞ»Ğ°ÑÑ‚ĞµÑ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ½ĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ñ‹Ñ… Ğ»Ğ¸Ñ†

```
ĞĞ´Ğ¼Ğ¸Ğ½ â†’ Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ ĞºĞ»Ğ°ÑÑ‚ĞµÑ€Ğ¾Ğ² â†’ FastAPI
                              â†“
                    Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ½ĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ñ‹Ñ… Ğ»Ğ¸Ñ† Ğ¸Ğ· Ğ‘Ğ”
                              â†“
                    HDBSCAN ĞºĞ»Ğ°ÑÑ‚ĞµÑ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ
                              â†“
                    Ğ“Ñ€ÑƒĞ¿Ğ¿Ğ¸Ñ€Ğ¾Ğ²ĞºĞ° Ğ¿Ğ¾ similarity
                              â†“
                    Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚ ĞºĞ»Ğ°ÑÑ‚ĞµÑ€Ğ¾Ğ² Ğ² UI
```

### 4. Ğ’ĞµÑ€Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ğ»Ğ¸Ñ†

```
ĞĞ´Ğ¼Ğ¸Ğ½ â†’ ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ Ğ»Ğ¸Ñ†Ğ° â†’ Next.js API â†’ Supabase
                                              â†“
                                    face_descriptors.verified = true
                                              â†“
                                    ĞŸĞµÑ€ĞµÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° HNSWLIB Ğ¸Ğ½Ğ´ĞµĞºÑĞ°
```

## ğŸ—„ï¸ Ğ¡Ñ…ĞµĞ¼Ğ° Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### Database Architecture

**SINGLE SOURCE OF TRUTH: Supabase PostgreSQL**

**PROHIBITED:**
- Using SQLite (database.py removed in v2.5.0)
- Direct database access from frontend
- Local data caching

**CORRECT:**
- All data in Supabase
- All operations through FastAPI endpoints
- HNSWLIB index synchronized with Supabase

### ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹

**galleries** - Ğ“Ğ°Ğ»ĞµÑ€ĞµĞ¸ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹
- `id` (uuid, PK)
- `title` (text)
- `event_date` (date)
- `location_id` (uuid, FK â†’ locations)
- `organizer_id` (uuid, FK â†’ organizers)
- `photographer_id` (uuid, FK â†’ photographers)
- `created_at` (timestamp)

**gallery_images** - Ğ¤Ğ¾Ñ‚Ğ¾Ğ³Ñ€Ğ°Ñ„Ğ¸Ğ¸ Ğ² Ğ³Ğ°Ğ»ĞµÑ€ĞµÑÑ…
- `id` (uuid, PK)
- `gallery_id` (uuid, FK â†’ galleries)
- `filename` (text)
- `blob_url` (text)
- `uploaded_at` (timestamp)

**people** - Ğ˜Ğ³Ñ€Ğ¾ĞºĞ¸
- `id` (uuid, PK)
- `name` (text)
- `telegram_id` (bigint, unique)
- `rating` (integer)
- `instagram` (text)
- `created_at` (timestamp)

**face_descriptors** - Ğ”ĞµÑĞºÑ€Ğ¸Ğ¿Ñ‚Ğ¾Ñ€Ñ‹ Ğ»Ğ¸Ñ†
- `id` (uuid, PK)
- `gallery_image_id` (uuid, FK â†’ gallery_images)
- `person_id` (uuid, FK â†’ people, nullable)
- `embedding` (vector(512))
- `bbox` (jsonb) - ĞºĞ¾Ğ¾Ñ€Ğ´Ğ¸Ğ½Ğ°Ñ‚Ñ‹ Ğ»Ğ¸Ñ†Ğ°
- `det_score` (float) - ÑƒĞ²ĞµÑ€ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ Ğ´ĞµÑ‚ĞµĞºÑ†Ğ¸Ğ¸
- `verified` (boolean) - Ğ²ĞµÑ€Ğ¸Ñ„Ğ¸Ñ†Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾ Ğ»Ğ¸ Ğ»Ğ¸Ñ†Ğ¾
- `created_at` (timestamp)

**Ğ¡Ğ²ÑĞ·Ğ¸:**
- galleries â†’ locations (many-to-one)
- galleries â†’ organizers (many-to-one)
- galleries â†’ photographers (many-to-one)
- gallery_images â†’ galleries (many-to-one)
- face_descriptors â†’ gallery_images (many-to-one)
- face_descriptors â†’ people (many-to-one, nullable)

## ğŸ” ĞÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ğ¸ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ

### Supabase Auth

1. **Google OAuth** - Ğ²Ñ…Ğ¾Ğ´ Ñ‡ĞµÑ€ĞµĞ· Google Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚
2. **Session Management** - ÑĞµÑÑĞ¸Ğ¸ Ñ…Ñ€Ğ°Ğ½ÑÑ‚ÑÑ Ğ² cookies
3. **Server-side Auth** - Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€Ğµ Ñ‡ĞµÑ€ĞµĞ· `serverGuard.ts`

### Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ñ€Ğ¾ÑƒÑ‚Ğ¾Ğ²

**ĞŸÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğµ:**
- `/[galleryId]` - Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ³Ğ°Ğ»ĞµÑ€ĞµĞ¹

**Ğ—Ğ°Ñ‰Ğ¸Ñ‰ĞµĞ½Ğ½Ñ‹Ğµ (Ñ‚Ñ€ĞµĞ±ÑƒÑÑ‚ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸):**
- `/admin/*` - Ğ²ÑĞµ Ğ°Ğ´Ğ¼Ğ¸Ğ½ Ñ€Ğ¾ÑƒÑ‚Ñ‹
- `/api/admin/*` - Ğ²ÑĞµ Ğ°Ğ´Ğ¼Ğ¸Ğ½ API endpoints

### Middleware

`lib/auth/serverGuard.ts` - Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€Ğµ:
```typescript
export async function requireAdmin() {
  const supabase = await createClient()
  const { data: { user } } = await supabase.auth.getUser()
  
  if (!user) {
    return NextResponse.json(
      { error: 'Forbidden: Admin role required' },
      { status: 403 }
    )
  }
  
  return { user }
}
```

## ğŸ¤– Ğ Ğ°ÑĞ¿Ğ¾Ğ·Ğ½Ğ°Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ»Ğ¸Ñ†

### Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸

1. **InsightFace** - Ğ´ĞµÑ‚ĞµĞºÑ†Ğ¸Ñ Ğ¸ Ñ€Ğ°ÑĞ¿Ğ¾Ğ·Ğ½Ğ°Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ»Ğ¸Ñ†
   - ĞœĞ¾Ğ´ĞµĞ»ÑŒ: `antelopev2`
   - Ğ Ğ°Ğ·Ğ¼ĞµÑ€ ÑĞ¼Ğ±ĞµĞ´Ğ´Ğ¸Ğ½Ğ³Ğ°: 512 Ğ¸Ğ·Ğ¼ĞµÑ€ĞµĞ½Ğ¸Ğ¹

2. **HNSWLIB** - Ğ²ĞµĞºÑ‚Ğ¾Ñ€Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞº
   - Ğ˜Ğ½Ğ´ĞµĞºÑ ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑÑ Ğ¸Ğ· Ğ²ĞµÑ€Ğ¸Ñ„Ğ¸Ñ†Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ»Ğ¸Ñ†
   - Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞº Ğ¿Ğ¾Ñ…Ğ¾Ğ¶Ğ¸Ñ… ÑĞ¼Ğ±ĞµĞ´Ğ´Ğ¸Ğ½Ğ³Ğ¾Ğ²

3. **HDBSCAN** - ĞºĞ»Ğ°ÑÑ‚ĞµÑ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ
   - Ğ“Ñ€ÑƒĞ¿Ğ¿Ğ¸Ñ€Ğ¾Ğ²ĞºĞ° Ğ½ĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ñ‹Ñ… Ğ»Ğ¸Ñ†
   - ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ° ĞºĞ»Ğ°ÑÑ‚ĞµÑ€Ğ¾Ğ²

### ĞŸÑ€Ğ¾Ñ†ĞµÑÑ Ñ€Ğ°ÑĞ¿Ğ¾Ğ·Ğ½Ğ°Ğ²Ğ°Ğ½Ğ¸Ñ

1. **Ğ”ĞµÑ‚ĞµĞºÑ†Ğ¸Ñ Ğ»Ğ¸Ñ†** - InsightFace Ğ½Ğ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ»Ğ¸Ñ†Ğ° Ğ½Ğ° Ñ„Ğ¾Ñ‚Ğ¾
2. **Ğ˜Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ğµ ÑĞ¼Ğ±ĞµĞ´Ğ´Ğ¸Ğ½Ğ³Ğ¾Ğ²** - Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ğ»Ğ¸Ñ†Ğ° ÑĞ¾Ğ·Ğ´Ğ°ĞµÑ‚ÑÑ Ğ²ĞµĞºÑ‚Ğ¾Ñ€ 512 Ğ¸Ğ·Ğ¼ĞµÑ€ĞµĞ½Ğ¸Ğ¹
3. **ĞŸĞ¾Ğ¸ÑĞº Ğ¿Ğ¾Ñ…Ğ¾Ğ¶Ğ¸Ñ…** - HNSWLIB Ğ¸Ñ‰ĞµÑ‚ Ğ±Ğ»Ğ¸Ğ¶Ğ°Ğ¹ÑˆĞ¸Ğµ ÑĞ¼Ğ±ĞµĞ´Ğ´Ğ¸Ğ½Ğ³Ğ¸ Ğ² Ğ¸Ğ½Ğ´ĞµĞºÑĞµ
4. **Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ** - Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ÑÑÑ‚ÑÑ Ğ¿Ğ¾Ñ€Ğ¾Ğ³Ğ¸ Ğ¿Ğ¾ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ñƒ (det_score, blur_score, face_size)
5. **Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ** - Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑÑÑ‚ÑÑ Ğ² `face_descriptors`

### ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ°

- `min_det_score` (0.0-1.0) - Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ°Ñ ÑƒĞ²ĞµÑ€ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ Ğ´ĞµÑ‚ĞµĞºÑ†Ğ¸Ğ¸
- `min_face_size` (px) - Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ Ğ»Ğ¸Ñ†Ğ°
- `min_blur_score` (10-150) - Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ñ€ĞµĞ·ĞºĞ¾ÑÑ‚ÑŒ (Ğ²Ñ‹ÑˆĞµ = Ñ‡ĞµÑ‚Ñ‡Ğµ)

## ğŸ”„ Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¸

### Vercel Blob Storage

- Ğ¥Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… Ñ„Ğ¾Ñ‚Ğ¾Ğ³Ñ€Ğ°Ñ„Ğ¸Ğ¹
- CDN Ğ´Ğ»Ñ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğ¹ Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ¸
- ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹

### Supabase

- PostgreSQL Ğ±Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
- Realtime subscriptions (Ğ½Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ¿Ğ¾ĞºĞ°)
- Row Level Security (RLS)
- Supabase Auth Ğ´Ğ»Ñ Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸

### Telegram Bot

- ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° Ñ„Ğ¾Ñ‚Ğ¾Ğ³Ñ€Ğ°Ñ„Ğ¸Ğ¹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼
- Webhook Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹
- Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ‡ĞµÑ€ĞµĞ· Telegram Bot API

## ğŸ“Š ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¸ Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ°

### Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

**Next.js:**
- Console logs Ğ² Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğµ
- Server logs Ğ² Ñ‚ĞµÑ€Ğ¼Ğ¸Ğ½Ğ°Ğ»Ğµ

**FastAPI:**
- Uvicorn logs
- Custom logging Ğ² `main.py`

### ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ†ĞµĞ»Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ‘Ğ”

ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ `database-integrity-checker.tsx` Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ 15 Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¾Ğº:
1. Orphaned face descriptors
2. Orphaned gallery images
3. Invalid person references
4. Duplicate embeddings
5. Missing bounding boxes
6. Invalid detection scores
7. Orphaned people
8. Galleries without images
9. Images without faces
10. Duplicate filenames
11. Invalid blob URLs
12. Missing gallery metadata
13. Inconsistent verification status
14. Duplicate person names
15. Invalid telegram IDs

## ğŸš€ Ğ Ğ°Ğ·Ğ²ĞµÑ€Ñ‚Ñ‹Ğ²Ğ°Ğ½Ğ¸Ğµ

### Next.js (Vercel)

1. Push ĞºĞ¾Ğ´ Ğ² GitHub
2. ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡Ğ¸Ñ‚Ğµ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¹ Ğº Vercel
3. ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹Ñ‚Ğµ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ
4. Deploy Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¿Ñ€Ğ¸ push

### FastAPI (Hetzner)

1. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ VPS Ğ½Ğ° Hetzner
2. Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ Python 3.9+
3. ĞšĞ»Ğ¾Ğ½Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¹
4. Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸
5. Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚Ğµ Ñ‡ĞµÑ€ĞµĞ· systemd service

Ğ¡Ğ¼. `python/DEPLOYMENT.md` Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ñ‹Ñ… Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¹.

---

**Ğ’ĞµÑ€ÑĞ¸Ñ:** 0.7.8
**ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ:** 2025-01-31
```

```markdown file="" isHidden
