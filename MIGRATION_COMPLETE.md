# –ú–∏–≥—Ä–∞—Ü–∏—è Supabase ‚Üí PostgreSQL - –ó–ê–í–ï–†–®–ï–ù–ê

## –°—Ç–∞—Ç—É—Å: 95% –ì–û–¢–û–í–û

–î–∞—Ç–∞: 2025-11-20
–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 00:45 UTC

---

## ‚úÖ –ß–¢–û –°–î–ï–õ–ê–ù–û

### 1. PostgreSQL –ö–ª–∏–µ–Ω—Ç (postgres_client.py)
- ‚úÖ –°–æ–∑–¥–∞–Ω –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π PostgreSQL –∫–ª–∏–µ–Ω—Ç –Ω–∞ asyncpg
- ‚úÖ 450+ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ —Å –ø–æ–ª–Ω—ã–º API
- ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–π –ë–î (1267 –ª–∏—Ü, 107 —á–µ–ª–æ–≤–µ–∫, 1138 –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤)
- ‚úÖ –í—Å–µ –º–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç:
  - `get_verified_faces()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ª–∏—Ü
  - `get_verified_faces_with_descriptors()` - —Å InsightFace –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–∞–º–∏
  - `search_similar_faces()` - –ø–æ–∏—Å–∫ –ø–æ –∫–æ—Å–∏–Ω—É—Å–Ω–æ–º—É —Å—Ö–æ–¥—Å—Ç–≤—É
  - `create_training_session()` - —Å–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–π –æ–±—É—á–µ–Ω–∏—è
  - `update_recognition_result()` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
  - –ò –µ—â–µ 15+ –º–µ—Ç–æ–¥–æ–≤

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –°–µ—Ä–≤–∏—Å—ã
- ‚úÖ `training_service.py` - –æ–±–Ω–æ–≤–ª–µ–Ω –Ω–∞ PostgreSQL
- ‚úÖ `face_recognition.py` - –æ–±–Ω–æ–≤–ª–µ–Ω –Ω–∞ PostgreSQL
- ‚úÖ `config.py` —Ä–æ—É—Ç–µ—Ä - –æ–±–Ω–æ–≤–ª–µ–Ω
- ‚úÖ `recognition.py` —Ä–æ—É—Ç–µ—Ä - –æ–±–Ω–æ–≤–ª–µ–Ω (32KB, 33 –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è db_client)

### 3. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞
–†–µ–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü:
- `people` - –∫–æ–ª–æ–Ω–∫–∞ `real_name` (–Ω–µ `name`)
- `galleries` - –∫–æ–ª–æ–Ω–∫–∞ `shoot_date` (–Ω–µ `event_date`)
- `photo_faces` - –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –ø—Ä—è–º–æ –≤ `insightface_descriptor` (vector 512)
- `gallery_images` - —Å–≤—è–∑—å —Å –≥–∞–ª–µ—Ä–µ—è–º–∏

### 4. FastAPI
- ‚úÖ –ó–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 8001
- ‚úÖ –í—Å–µ —Ä–æ—É—Ç–µ—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω—ã
- ‚úÖ /docs –¥–æ—Å—Ç—É–ø–µ–Ω (–∫–æ–¥ 200)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç PostgreSQL –≤–º–µ—Å—Ç–æ Supabase

### 5. –§–∞–π–ª—ã –Ω–∞ –°–µ—Ä–≤–µ—Ä–µ
–í—Å–µ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä:
\`\`\`
/home/nickr/python/
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ postgres_client.py (19KB) ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ training_service.py (7.3KB) ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ face_recognition.py (47KB) ‚úÖ
‚îÇ   ‚îî‚îÄ‚îÄ supabase_client_old.py (–ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω)
‚îú‚îÄ‚îÄ routers/
‚îÇ   ‚îú‚îÄ‚îÄ config.py (2.2KB) ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ recognition.py (32KB) ‚úÖ
‚îÇ   ‚îî‚îÄ‚îÄ training.py (–æ–±–Ω–æ–≤–ª–µ–Ω) ‚úÖ
‚îî‚îÄ‚îÄ main.py (–æ–±–Ω–æ–≤–ª–µ–Ω) ‚úÖ
\`\`\`

### 6. –ê—Ä—Ö–∏–≤—ã
- ‚úÖ `working_postgres_files_complete.tar.gz` - –≤—Å–µ —Ä–∞–±–æ—á–∏–µ —Ñ–∞–π–ª—ã
- ‚úÖ –í—Å–µ —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã —Å Supabase –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω—ã –≤ *.supabase_backup

---

## üìã –û–°–¢–ê–õ–û–°–¨ –°–î–ï–õ–ê–¢–¨

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏ (5% —Ä–∞–±–æ—Ç—ã)

1. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å FastAPI —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã** (15 –º–∏–Ω)
   \`\`\`bash
   # 1. Config endpoint
   curl http://23.88.61.20:8001/api/v2/config
   
   # 2. Training stats
   curl http://23.88.61.20:8001/api/v2/training/stats
   
   # 3. Recognition test (–Ω—É–∂–µ–Ω gallery_id)
   curl -X POST http://23.88.61.20:8001/api/v2/recognition/detect \
     -H "Content-Type: application/json" \
     -d '{"gallery_id": "test-id"}'
   \`\`\`

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é Frontend ‚Üí Backend** (10 –º–∏–Ω)
   - –û—Ç–∫—Ä—ã—Ç—å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
   - –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –∏–∑ PostgreSQL

3. **–û–±–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ** (5 –º–∏–Ω)
   \`\`\`bash
   # –í /home/nickr/python/.env –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å:
   DATABASE_URL=postgresql://galeries_user:galeries_strong_pass_2025@localhost/galleries
   \`\`\`

---

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò

### Flow: Frontend ‚Üí Backend ‚Üí PostgreSQL

\`\`\`
Frontend (Next.js)
  ‚Üì fetch(FASTAPI_URL)
  ‚Üì
FastAPI (port 8001)
  ‚Üì main.py
  ‚Üì
Routers
  ‚îú‚îÄ‚îÄ /api/v2/config ‚Üí config.py
  ‚îú‚îÄ‚îÄ /api/v2/recognition/* ‚Üí recognition.py
  ‚îî‚îÄ‚îÄ /api/v2/training/* ‚Üí training.py
  ‚Üì
Services
  ‚îú‚îÄ‚îÄ training_service.py
  ‚îî‚îÄ‚îÄ face_recognition.py
  ‚Üì
PostgreSQL Client (postgres_client.py)
  ‚Üì asyncpg
  ‚Üì
PostgreSQL (localhost:5432)
  ‚îî‚îÄ‚îÄ Database: galleries
      ‚îú‚îÄ‚îÄ people
      ‚îú‚îÄ‚îÄ galleries
      ‚îú‚îÄ‚îÄ gallery_images
      ‚îú‚îÄ‚îÄ photo_faces
      ‚îî‚îÄ‚îÄ face_training_sessions
\`\`\`

### Environment Variables

**Frontend (.env.local):**
\`\`\`
FASTAPI_URL=http://23.88.61.20:8001
NEXT_PUBLIC_FASTAPI_URL=http://23.88.61.20:8001
\`\`\`

**Backend (.env):**
\`\`\`
DATABASE_URL=postgresql://galeries_user:galeries_strong_pass_2025@localhost/galleries
\`\`\`

---

## üéØ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### –ß–µ–∫-–ª–∏—Å—Ç –±–∞–∑–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤

- [ ] FastAPI –∑–∞–ø—É—â–µ–Ω –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] /docs –¥–æ—Å—Ç—É–ø–µ–Ω
- [ ] GET /api/v2/config –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- [ ] GET /api/v2/training/stats –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
- [ ] Frontend –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ FastAPI
- [ ] –î–∞–Ω–Ω—ã–µ –∏–∑ PostgreSQL –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ –∞–¥–º–∏–Ω–∫–µ

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

\`\`\`bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ FastAPI —Ä–∞–±–æ—Ç–∞–µ—Ç
curl http://23.88.61.20:8001/docs

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å health (–µ—Å–ª–∏ –µ—Å—Ç—å endpoint)
curl http://23.88.61.20:8001/health

# 3. –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
curl http://23.88.61.20:8001/api/v2/config

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –æ–±—É—á–µ–Ω–∏—è
curl http://23.88.61.20:8001/api/v2/training/stats

# 5. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ FastAPI
tail -f /home/nickr/python/fastapi.log
\`\`\`

---

## üìù –í–ê–ñ–ù–´–ï –ó–ê–ú–ï–¢–ö–ò

### –ß—Ç–æ –ù–ï —Ç—Ä–æ–≥–∞—Ç—å
- `services/database.py` (PlayerDatabase) - —ç—Ç–æ –ª–æ–∫–∞–ª—å–Ω–∞—è SQLite –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è, –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å
- `services/supabase_client_old.py` - —Å—Ç–∞—Ä—ã–π —Ñ–∞–π–ª, –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏

### –ü—Ä–æ–±–ª–µ–º—ã –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ —Ä–µ—à–µ–Ω—ã
1. ‚úÖ –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ –∫–æ–ª–æ–Ω–æ–∫ (`name` ‚Üí `real_name`, `event_date` ‚Üí `shoot_date`)
2. ‚úÖ TrainingService —Ç—Ä–µ–±–æ–≤–∞–ª face_recognizer –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ
3. ‚úÖ –î–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ photo_faces, –∞ –Ω–µ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ
4. ‚úÖ –ü–æ—Ä—Ç FastAPI - 8001, –∞ –Ω–µ 8000

---

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã** - —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —á–∏—Ç–∞—é—Ç—Å—è –∏–∑ PostgreSQL
2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Frontend –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é** - –∞–¥–º–∏–Ω–∫–∞ –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –Ω–æ–≤—ã–º backend
3. **–£–ø–∞–∫–æ–≤–∞—Ç—å –≤ Docker** (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ) - –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
4. **–û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é** - —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ README

---

## üìû –ö–û–ù–¢–ê–ö–¢–´ –ò –°–°–´–õ–ö–ò

**–°–µ—Ä–≤–µ—Ä:** 23.88.61.20
**FastAPI:** http://23.88.61.20:8001
**FastAPI Docs:** http://23.88.61.20:8001/docs
**PostgreSQL:** localhost:5432 (database: galleries)
**Python venv:** /home/nickr/python/venv

**–ê—Ä—Ö–∏–≤—ã:**
- `/home/nickr/python/working_postgres_files_complete.tar.gz` - –≤—Å–µ —Ä–∞–±–æ—á–∏–µ —Ñ–∞–π–ª—ã

---

**–°—Ç–∞—Ç—É—Å: –ì–û–¢–û–í–û –ö –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ** ‚úÖ
