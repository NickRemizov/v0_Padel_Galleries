# üéæ Padel Tournament Face Recognition Server v3.2.8

–°–µ—Ä–≤–µ—Ä –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –∏–≥—Ä–æ–∫–æ–≤ –Ω–∞ —Ç—É—Ä–Ω–∏—Ä–∞—Ö –ø–æ –ø–∞–¥–µ–ª—É —Å OAuth –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π –∏ —Å–∏—Å—Ç–µ–º–æ–π –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π.

## üÜï –ß—Ç–æ –Ω–æ–≤–æ–≥–æ –≤ v3.2.8

- ‚úÖ **–ú–µ—Ç—Ä–∏–∫–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è** - blur_score, distance_to_nearest, top_matches –≤ /api/detect-faces
- ‚úÖ **–ü–∞—Ä–∞–º–µ—Ç—Ä apply_quality_filters** - –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫–ª—é—á–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –∫–∞—á–µ—Å—Ç–≤–∞
- ‚úÖ **–¢–æ–ø-3 –ø–æ—Ö–æ–∂–∏—Ö –ª–∏—Ü** - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–º–µ–Ω–∞ –∏ similarity –¥–ª—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ª–∏—Ü
- ‚úÖ **–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ –±–ª–∏–∂–∞–π—à–µ–≥–æ** - –º–µ—Ç—Ä–∏–∫–∞ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è

## üöÄ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **InsightFace (antelopev2)** - —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –ª–∏—Ü
- **hnswlib** - –±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –ª–∏—Ü
- **HDBSCAN** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞
- **FastAPI** - REST API
- **Supabase** - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
- **Google OAuth 2.0** - –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- **Python 3.11**

## üì¶ –ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –°–∫–∞—á–∞–π—Ç–µ –∞—Ä—Ö–∏–≤ `galeries.zip`
2. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –≤ `/home/nickr/`
3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—ã:

\`\`\`bash
cd /home/nickr
sudo rm -rf python
unzip -o galeries.zip
chmod +x SETUP.sh
sudo ./SETUP.sh
cd python && ./start.sh
\`\`\`

**–ì–æ—Ç–æ–≤–æ!** –°–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ `http://23.88.61.20:8001`

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç SETUP.sh

- –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å—Ç–∞—Ä—ã–π —Å–µ—Ä–≤–µ—Ä (–µ—Å–ª–∏ –∑–∞–ø—É—â–µ–Ω)
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç Python 3.11 –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –°–æ–∑–¥–∞–µ—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—Å–µ Python –ø–∞–∫–µ—Ç—ã
- –°–æ–∑–¥–∞–µ—Ç .env —Ñ–∞–π–ª —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
- –°–æ–∑–¥–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

## üîß API Endpoints

### Recognition API (v1)

#### –î–µ—Ç–µ–∫—Ü–∏—è –ª–∏—Ü —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ (–ù–û–í–û–ï –≤ v3.2.8)
\`\`\`bash
POST /api/detect-faces
Content-Type: application/json

{
  "image_url": "https://example.com/photo.jpg",
  "apply_quality_filters": false  // –ù–û–í–û–ï: –æ—Ç–∫–ª—é—á–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –∫–∞—á–µ—Å—Ç–≤–∞
}

Response:
{
  "faces": [
    {
      "insightface_bbox": {"x": 100, "y": 200, "width": 150, "height": 150},
      "confidence": 0.99,
      "blur_score": 245.3,  // –ù–û–í–û–ï: –æ—Ü–µ–Ω–∫–∞ —Ä–∞–∑–º—ã—Ç–∏—è (–≤—ã—à–µ = —á–µ—Ç—á–µ)
      "embedding": [...],
      "distance_to_nearest": 0.42,  // –ù–û–í–û–ï: —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ –±–ª–∏–∂–∞–π—à–µ–≥–æ –∏–∑–≤–µ—Å—Ç–Ω–æ–≥–æ –ª–∏—Ü–∞
      "top_matches": [  // –ù–û–í–û–ï: —Ç–æ–ø-3 –ø–æ—Ö–æ–∂–∏—Ö –ª–∏—Ü
        {"person_id": "uuid", "name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤", "similarity": 0.58},
        {"person_id": "uuid", "name": "–ü–µ—Ç—Ä –ü–µ—Ç—Ä–æ–≤", "similarity": 0.45}
      ]
    }
  ]
}
\`\`\`

#### –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –ª–∏—Ü–∞
\`\`\`bash
POST /api/recognize-face
Content-Type: application/json

{
  "embedding": [0.1, 0.2, ...],  // 512-–º–µ—Ä–Ω—ã–π –≤–µ–∫—Ç–æ—Ä
  "confidence_threshold": 0.60
}
\`\`\`

#### –ü–∞–∫–µ—Ç–Ω–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ
\`\`\`bash
POST /api/batch-recognize
Content-Type: application/json

{
  "gallery_ids": ["gallery1", "gallery2"],
  "confidence_threshold": 0.60
}
\`\`\`

#### –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ª–∏—Ü
\`\`\`bash
POST /api/cluster-unknown-faces?gallery_id=xxx&min_cluster_size=2
\`\`\`

#### –ü–µ—Ä–µ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞
\`\`\`bash
POST /api/rebuild-index
\`\`\`

### Training API (v2)

#### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
\`\`\`bash
GET /api/v2/config
PUT /api/v2/config
\`\`\`

#### –ò—Å—Ç–æ—Ä–∏—è –æ–±—É—á–µ–Ω–∏–π
\`\`\`bash
GET /api/v2/train/history?limit=10&offset=0
\`\`\`

#### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞—Ç–∞—Å–µ—Ç–∞
\`\`\`bash
POST /api/v2/train/prepare
\`\`\`

#### –ó–∞–ø—É—Å–∫ –æ–±—É—á–µ–Ω–∏—è
\`\`\`bash
POST /api/v2/train/execute
\`\`\`

## üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Vercel (Next.js)

–í –≤–∞—à–µ–º Next.js –ø—Ä–æ–µ–∫—Ç–µ –Ω–∞ Vercel –¥–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è:

\`\`\`
FASTAPI_URL=http://23.88.61.20:8001
NEXT_PUBLIC_FASTAPI_URL=http://23.88.61.20:8001
\`\`\`

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫:

\`\`\`typescript
// –î–µ—Ç–µ–∫—Ü–∏—è –ª–∏—Ü –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∫–∞—á–µ—Å—Ç–≤–∞
const response = await fetch(`${API_URL}/api/detect-faces`, {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    image_url: photoUrl,
    apply_quality_filters: false  // –û—Ç–∫–ª—é—á–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
  })
});

const { faces } = await response.json();

faces.forEach(face => {
  console.log('Blur score:', face.blur_score);  // –û—Ü–µ–Ω–∫–∞ —Ä–∞–∑–º—ã—Ç–∏—è
  console.log('Distance to nearest:', face.distance_to_nearest);  // –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ
  console.log('Top matches:', face.top_matches);  // –ü–æ—Ö–æ–∂–∏–µ –ª–∏—Ü–∞
});
\`\`\`

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ú–µ—Ç—Ä–∏–∫–∏ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. –í–µ—Ä—Å–∏—è –±—ç–∫–µ–Ω–¥–∞ v3.2.8: `grep "version=" /home/nickr/python/main.py`
2. –õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞: `tail -f /home/nickr/python/nohup.out`
3. –ò–Ω–¥–µ–∫—Å –∑–∞–≥—Ä—É–∂–µ–Ω: –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è `[v3.0] ‚úì HNSW index created`

### –û—à–∏–±–∫–∞ "players_id_map is empty"

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –∏–Ω–¥–µ–∫—Å –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. –ï—Å—Ç—å –ª–∏ verified faces –≤ Supabase
2. –ï—Å—Ç—å –ª–∏ insightface_descriptor –≤ —Ç–∞–±–ª–∏—Ü–µ face_descriptors
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä: `cd /home/nickr/python && ./restart.sh`

### –ú–µ–¥–ª–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–µ—Ä–≤–µ—Ä —Å GPU –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è
- –£–º–µ–Ω—å—à–∏—Ç–µ —Ä–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π
- –£–≤–µ–ª–∏—á—å—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ workers –≤ production —Ä–µ–∂–∏–º–µ

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **CPU (–±–µ–∑ GPU)**: ~2-3 —Å–µ–∫—É–Ω–¥—ã –Ω–∞ —Ñ–æ—Ç–æ
- **GPU**: ~0.3-0.5 —Å–µ–∫—É–Ω–¥—ã –Ω–∞ —Ñ–æ—Ç–æ
- **–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞**: ~1-2 —Å–µ–∫—É–Ω–¥—ã –Ω–∞ 100 –ª–∏—Ü
- **–û–±—É—á–µ–Ω–∏–µ**: –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ª–∏—Ü (–æ–±—ã—á–Ω–æ 1-5 –º–∏–Ω—É—Ç)

## üìù –õ–æ–≥–∏

–õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `nohup.out`:

\`\`\`bash
cd /home/nickr/python
tail -f nohup.out
\`\`\`

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. –õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞: `tail -f /home/nickr/python/nohup.out`
2. –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ—Ä—Ç–∞ 8001: `curl http://23.88.61.20:8001/api/health`
3. –ù–∞–ª–∏—á–∏–µ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ: `df -h`
4. –í–µ—Ä—Å–∏—é Python: `python3.11 --version`
5. –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ `.env`
6. –í–µ—Ä—Å–∏—é –±—ç–∫–µ–Ω–¥–∞: `grep "version=" /home/nickr/python/main.py`

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ:
- Swagger UI: `http://23.88.61.20:8001/docs`
- ReDoc: `http://23.88.61.20:8001/redoc`

## üÜï Changelog

### v3.2.8 (–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç—Ä–∏–∫–∏: blur_score, distance_to_nearest, top_matches
- ‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä apply_quality_filters –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
- ‚úÖ –¢–æ–ø-3 –ø–æ—Ö–æ–∂–∏—Ö –ª–∏—Ü —Å –∏–º–µ–Ω–∞–º–∏ –∏ similarity
- ‚úÖ –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ –±–ª–∏–∂–∞–π—à–µ–≥–æ –∏–∑–≤–µ—Å—Ç–Ω–æ–≥–æ –ª–∏—Ü–∞

### v3.2.7
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è SupabaseClient
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω load_quality_filters()
- ‚úÖ –§–∏–ª—å—Ç—Ä—ã –∫–∞—á–µ—Å—Ç–≤–∞ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### v3.2.1
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã Training API endpoints (/api/v2/*)
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –ª–∏—Ü
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Supabase –¥–ª—è –æ–±—É—á–µ–Ω–∏—è
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ API
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –æ–±—É—á–µ–Ω–∏–π
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ SETUP.sh

### v3.2.0
- –ë–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è —Å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ–º –ª–∏—Ü
- Google OAuth –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∏–≥—Ä–æ–∫–æ–≤
