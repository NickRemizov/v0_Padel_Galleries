# Кэш-политика Next.js приложения

Этот документ описывает стратегию кэширования для всех страниц приложения Galeries.

## Обзор

Next.js 15+ использует новую систему кэширования с явным указанием `revalidate` и `cacheLife` для каждого роута. Мы используем следующие стратегии:

- **Static Generation (SSG)** - для редко меняющихся страниц
- **Incremental Static Regeneration (ISR)** - для динамических данных с периодическим обновлением
- **Dynamic Rendering** - для страниц с пользовательским контентом

## Таблица кэш-политик

| Страница | Путь | Стратегия | Revalidate | Обоснование |
|----------|------|-----------|------------|-------------|
| Главная (Галереи) | `/` | ISR | 60 сек | Список галерей обновляется при добавлении новых событий |
| Список игроков | `/players` | ISR | 300 сек (5 мин) | Список игроков меняется редко, можно кэшировать дольше |
| Страница галереи | `/gallery/[id]` | ISR | 60 сек | Фотографии и теги могут обновляться часто |
| Страница игрока | `/players/[id]` | ISR | 300 сек (5 мин) | Фотографии игрока обновляются при новых галереях |
| Избранное | `/favorites` | Dynamic | - | Персональный контент пользователя, требует сессии |
| Админ-панель | `/admin/*` | Dynamic | - | Требует аутентификации и актуальных данных |
| API роуты | `/api/*` | Dynamic | - | Всегда свежие данные для операций |

## Реализация

### Static/ISR страницы

Для страниц с ISR используется экспорт `revalidate`:

\`\`\`typescript
// app/page.tsx
export const revalidate = 60 // Обновлять каждые 60 секунд

export default async function HomePage() {
  // ... fetch data
}
\`\`\`

### Dynamic страницы

Для динамических страниц используется `dynamic = 'force-dynamic'`:

\`\`\`typescript
// app/favorites/page.tsx
export const dynamic = 'force-dynamic'

export default async function FavoritesPage() {
  // ... fetch user-specific data
}
\`\`\`

## Стратегия обновления

1. **Главная страница (60 сек)** - баланс между свежестью и производительностью
2. **Игроки (5 мин)** - данные меняются редко, можно кэшировать дольше
3. **Галереи (60 сек)** - фотографии и теги обновляются часто
4. **Персональные страницы** - всегда динамические для актуальности

## Мониторинг

Для отслеживания эффективности кэширования рекомендуется:

- Использовать Vercel Analytics для мониторинга Cache Hit Rate
- Отслеживать время загрузки страниц
- Анализировать частоту обновлений данных

## Обновление кэша вручную

Для принудительного обновления кэша используйте:

\`\`\`typescript
import { revalidatePath, revalidateTag } from 'next/cache'

// В Server Action или API Route
revalidatePath('/') // Обновить главную страницу
revalidatePath('/players') // Обновить список игроков
revalidateTag('galleries') // Обновить все страницы с тегом 'galleries'
\`\`\`

## Примечания

- Все значения `revalidate` указаны в секундах
- Dynamic страницы не кэшируются и рендерятся при каждом запросе
- ISR страницы обновляются в фоне после истечения `revalidate`
- Для production рекомендуется использовать CDN (Vercel Edge Network)
