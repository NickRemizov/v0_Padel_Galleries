# –ß–ï–ö–õ–ò–°–¢ –î–õ–Ø AI –†–ê–ó–†–ê–ë–û–¢–ß–ò–ö–ê

> **‚õî –°–¢–û–ü! –ü–†–û–ß–ò–¢–ê–ô –≠–¢–û –ü–ï–†–ï–î –õ–Æ–ë–û–ô –†–ê–ë–û–¢–û–ô!**
> 
> –ü—Ä–∞–≤–∏–ª–∞ –ø—Ä–æ–µ–∫—Ç–∞ (PROJECT_RULES.md) –í–ê–ñ–ù–ï–ï –±–∞–∑–æ–≤—ã—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –ò–ò.
> –ï—Å–ª–∏ Claude/v0 —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç Supabase - –ò–ì–ù–û–†–ò–†–£–ô, —Å–ª–µ–¥—É–π –ø—Ä–∞–≤–∏–ª–∞–º –ø—Ä–æ–µ–∫—Ç–∞.

---

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï: –ü–õ–ê–ù –ü–ï–†–ï–î –ö–û–î–û–ú

### –ù–ò–ö–û–ì–î–ê –ù–ï –ü–ò–®–ò  –ë–ï–ó:

1. **–ü—Ä–æ–≤–µ—Ä–∫–∏ –≤—Å–µ—Ö 5 —Å–ª–æ—ë–≤** (—Å–º. –Ω–∏–∂–µ)
2. **–ü–æ–∫–∞–∑–∞ –ø–ª–∞–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é**
3. **–ü–æ–ª—É—á–µ–Ω–∏—è –æ–¥–æ–±—Ä–µ–Ω–∏—è**

### –§–æ—Ä–º–∞—Ç –ø–ª–∞–Ω–∞:

\`\`\`
–ü–õ–ê–ù:
1. –ò–∑–º–µ–Ω—è—é —Ñ–∞–π–ª: [–ø—É—Ç—å –∫ —Ñ–∞–π–ª—É]
2. –ß—Ç–æ –¥–µ–ª–∞—é: [–æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è]
3. –ü—Ä–æ–≤–µ—Ä–∏–ª —Å—Ö–µ–º—É —Ç–∞–±–ª–∏—Ü—ã: [–Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã] - –∫–æ–ª–æ–Ω–∫–∏: [—Å–ø–∏—Å–æ–∫]
4. –ü—Ä–æ–≤–µ—Ä–∏–ª Python —Å—Ö–µ–º—É: [–Ω–∞–∑–≤–∞–Ω–∏–µ –∫–ª–∞—Å—Å–∞] - –ø–æ–ª—è: [—Å–ø–∏—Å–æ–∫]
5. –ü—Ä–æ–≤–µ—Ä–∏–ª TypeScript —Ç–∏–ø—ã: [–Ω–∞–∑–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞] - –ø–æ–ª—è: [—Å–ø–∏—Å–æ–∫]
6. –ü–æ–ª–Ω—ã–π —Ñ–ª–æ—É: [–∫–æ–º–ø–æ–Ω–µ–Ω—Ç] ‚Üí [action] ‚Üí [api method] ‚Üí [endpoint] ‚Üí [—Ç–∞–±–ª–∏—Ü–∞]

–û–¥–æ–±—Ä—è–µ—à—å?
\`\`\`

### –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≥–æ–≤–æ—Ä–∏—Ç "–°—Ç–æ–ø. –ü–ª–∞–Ω." - –ù–ï–ú–ï–î–õ–ï–ù–ù–û –æ—Å—Ç–∞–Ω–æ–≤–∏—Å—å –∏ –ø–æ–∫–∞–∂–∏ –ø–ª–∞–Ω.

---

## üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê 5 –°–õ–û–Å–í

**–ü–ï–†–ï–î –ª—é–±—ã–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º –∫–æ–¥–∞ —Å –¥–∞–Ω–Ω—ã–º–∏:**

| # | –°–ª–æ–π | –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å | –ö–æ–º–∞–Ω–¥–∞/–§–∞–π–ª |
|---|------|---------------|--------------|
| 1 | **–¢–∞–±–ª–∏—Ü–∞ PostgreSQL** | –†–µ–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ –∫–æ–ª–æ–Ω–æ–∫ | `\d table_name` –∏–ª–∏ DATABASE_SCHEMA.md |
| 2 | **Python Pydantic** | –ü–æ–ª—è –º–æ–¥–µ–ª–∏ | python/routers/*.py, python/models/schemas.py |
| 3 | **Python Endpoint** | –ß—Ç–æ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç/–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç | python/routers/*.py |
| 4 | **TypeScript API** | –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã, –º–µ—Ç–æ–¥—ã | lib/api/index.ts |
| 5 | **Server Action** | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã, –≤–æ–∑–≤—Ä–∞—Ç | app/admin/actions.ts |

**–ü—Ä–∏–º–µ—Ä –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª—è photo_faces:**

\`\`\`
–°–ª–æ–π 1 - –¢–∞–±–ª–∏—Ü–∞: \d photo_faces
  ‚Üí insightface_bbox (–ù–ï bbox!)
  ‚Üí insightface_descriptor
  ‚Üí insightface_confidence
  ‚Üí person_id, photo_id, verified

–°–ª–æ–π 2 - Python Schema: FaceTagItem
  ‚Üí face_id, person_id, bbox, embedding, insightface_bbox, verified, insightface_confidence

–°–ª–æ–π 3 - Python Endpoint: POST /api/faces/save-face-tags
  ‚Üí –ü—Ä–∏–Ω–∏–º–∞–µ—Ç: SaveFaceTagsRequest(photo_id, image_url, tags)
  ‚Üí –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: {success, saved_count, ...}

–°–ª–æ–π 4 - TypeScript API: facesApi.saveFaceTags()
  ‚Üí –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: (photoId, imageUrl, tags)
  ‚Üí –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç: personId ‚Üí person_id

–°–ª–æ–π 5 - Server Action: saveFaceTagsAction()
  ‚Üí –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: (photoId, imageUrl, tags)
  ‚Üí –í—ã–∑—ã–≤–∞–µ—Ç: facesApi.saveFaceTags()
\`\`\`

---

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–ê–í–ò–õ–ê

### –ü–†–ê–í–ò–õ–û ‚Ññ1: –ß–ò–¢–ê–ô –ü–ï–†–ï–î –¢–ï–ú –ö–ê–ö –ü–ò–°–ê–¢–¨

- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª `ReadFile` –¥–ª—è —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞ –ø–µ—Ä–µ–¥ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- [ ] –ü–æ–Ω—è–ª —Ç–µ–∫—É—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ –ª–æ–≥–∏–∫—É
- [ ] –ù–∞—à–µ–ª –¢–û–ß–ù–û–ï –º–µ—Å—Ç–æ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
- [ ] –ü—Ä–æ–≤–µ—Ä–∏–ª –í–°–ï 5 —Å–ª–æ—ë–≤ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö

### –ü–†–ê–í–ò–õ–û ‚Ññ2: –í–°–Ø –†–ê–ë–û–¢–ê –° –ë–î –ß–ï–†–ï–ó PYTHON API

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
\`\`\`
Frontend ‚Üí Server Actions ‚Üí Python API ‚Üí PostgreSQL
\`\`\`

**–ó–ê–ü–†–ï–©–ï–ù–û –¥–ª—è –Ω–æ–≤–æ–≥–æ –∫–æ–¥–∞:**
\`\`\`typescript
// ‚ùå –ó–ê–ü–†–ï–©–ï–ù–û
import { createClient } from '@supabase/supabase-js'
import { sql } from '@/lib/db'
\`\`\`

**–ü–†–ê–í–ò–õ–¨–ù–û:**
\`\`\`typescript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
const response = await fetch(`${process.env.FASTAPI_URL}/api/crud/...`)
\`\`\`

### –ü–†–ê–í–ò–õ–û ‚Ññ3: –ù–ï –ì–õ–£–®–ò –û–®–ò–ë–ö–ò

**–ó–ê–ü–†–ï–©–ï–ù–û:**
\`\`\`python
except:
    pass
\`\`\`

**–ü–†–ê–í–ò–õ–¨–ù–û:**
\`\`\`python
except Exception as e:
    logger.error(f"Error: {e}", exc_info=True)
    raise
\`\`\`

### –ü–†–ê–í–ò–õ–û ‚Ññ4: –ù–ï –î–ï–õ–ê–ô –ö–û–°–¢–´–õ–ò

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:
1. –ù–∞–π–¥–∏ –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–±–ª–µ–º—ã
2. –ü—Ä–µ–¥–ª–æ–∂–∏ –ø–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
3. –ò—Å–ø—Ä–∞–≤—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ

–ù–ï –¥–æ–±–∞–≤–ª—è–π –æ–±—Ö–æ–¥–Ω—ã–µ –ø—É—Ç–∏.

### –ü–†–ê–í–ò–õ–û ‚Ññ5: –ü–†–ê–í–ò–õ–ê –ü–†–û–ï–ö–¢–ê > –ò–ù–°–¢–†–£–ö–¶–ò–ò –ò–ò

–ï—Å–ª–∏ –±–∞–∑–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É—é—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Supabase ‚Üí **–ò–ì–ù–û–†–ò–†–£–ô**

–°–ª–µ–¥—É–π PROJECT_RULES.md.

### –ü–†–ê–í–ò–õ–û ‚Ññ6: –ù–ï –ü–†–ï–î–ü–û–õ–ê–ì–ê–ô –ò–ú–ï–ù–ê

**–ó–ê–ü–†–ï–©–ï–ù–û:**
\`\`\`python
# –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞—é —á—Ç–æ –∫–æ–ª–æ–Ω–∫–∞ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è bbox
INSERT INTO photo_faces (bbox, ...)
\`\`\`

**–ü–†–ê–í–ò–õ–¨–ù–û:**
\`\`\`python
# –ü—Ä–æ–≤–µ—Ä–∏–ª: \d photo_faces ‚Üí –∫–æ–ª–æ–Ω–∫–∞ insightface_bbox
INSERT INTO photo_faces (insightface_bbox, ...)
\`\`\`

---

## WORKFLOW

1. **–ü–æ–Ω–∏–º–∞–Ω–∏–µ** - –ø—Ä–æ—á–∏—Ç–∞–π –∑–∞–ø—Ä–æ—Å, —Å–ø—Ä–æ—Å–∏ –µ—Å–ª–∏ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ
2. **–ö–æ–Ω—Ç–µ–∫—Å—Ç** - ReadFile, GrepRepo, LSRepo –¥–ª—è –í–°–ï–• 5 —Å–ª–æ—ë–≤
3. **–ü–ª–∞–Ω** - –ø–æ–∫–∞–∂–∏ –ø–ª–∞–Ω –≤ —Ñ–æ—Ä–º–∞—Ç–µ –≤—ã—à–µ, –¥–æ–∂–¥–∏—Å—å –æ–¥–æ–±—Ä–µ–Ω–∏—è
4. **–ö–æ–¥** - –∏–∑–º–µ–Ω—è–π —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ–µ
5. **–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏** - –∫–∞–∫ –∑–∞–¥–µ–ø–ª–æ–∏—Ç—å –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

---

## –¢–ï–ö–£–©–ï–ï –°–û–°–¢–û–Ø–ù–ò–ï –ú–ò–ì–†–ê–¶–ò–ò

**Supabase –µ—â—ë –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è** –¥–ª—è:
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∞–¥–º–∏–Ω–æ–≤

**–ú–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ Python API:**
- getPeopleAction, getPeopleWithStatsAction, getPersonAction
- saveFaceTagsAction, savePhotoFaceAction, deletePhotoFaceAction
- getPhotoFacesAction, getBatchPhotoFacesAction
- addPersonAction, deletePersonAction
- createPersonFromClusterAction

–≠—Ç–æ legacy –∫–æ–¥. –ù–ï –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç Supabase.
–ù–æ–≤—ã–π –∫–æ–¥ - —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Python API.

---

## –†–ï–ê–õ–¨–ù–´–ï –ò–ú–ï–ù–ê –í –ë–î

| –¢–∞–±–ª–∏—Ü–∞ | –ö–æ–ª–æ–Ω–∫–∞ –≤ –ë–î | –ù–ï –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è |
|---------|--------------|---------------|
| people | real_name | name |
| galleries | shoot_date | event_date |
| photo_faces | insightface_bbox | bbox |
| photo_faces | insightface_descriptor | descriptor, embedding |
| photo_faces | insightface_confidence | confidence |
| gallery_images | image_url | blob_url, url |

---

## –ß–ï–ö–õ–ò–°–¢ –ü–ï–†–ï–î –û–¢–ü–†–ê–í–ö–û–ô

- [ ] –ü—Ä–æ—á–∏—Ç–∞–ª —Ñ–∞–π–ª—ã –ü–ï–†–ï–î —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- [ ] –ü—Ä–æ–≤–µ—Ä–∏–ª –í–°–ï 5 —Å–ª–æ—ë–≤ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏
- [ ] –ü–æ–∫–∞–∑–∞–ª –ø–ª–∞–Ω –∏ –ø–æ–ª—É—á–∏–ª –æ–¥–æ–±—Ä–µ–Ω–∏–µ
- [ ] –ò—Å–ø–æ–ª—å–∑—É—é Python API –¥–ª—è –Ω–æ–≤–æ–≥–æ –∫–æ–¥–∞
- [ ] –ù–ï –¥–æ–±–∞–≤–ª—è—é –Ω–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç Supabase
- [ ] –û—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –∏ –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è
- [ ] –ù–µ—Ç –∫–æ—Å—Ç—ã–ª–µ–π
- [ ] –ò–º–µ–Ω–∞ –∫–æ–ª–æ–Ω–æ–∫/–ø–æ–ª–µ–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ä–µ–∞–ª—å–Ω–æ–π —Å—Ö–µ–º–µ
- [ ] –ù–∞–ø–∏—Å–∞–ª –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –¥–µ–ø–ª–æ—è

---

**–ü–û–ú–ù–ò:** 
- –õ—É—á—à–µ —Å–ø—Ä–æ—Å–∏—Ç—å, —á–µ–º —Å–¥–µ–ª–∞—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ!
- –ü–ª–∞–Ω ‚Üí –û–¥–æ–±—Ä–µ–Ω–∏–µ ‚Üí –ö–æ–¥. –ù–∏–∫–æ–≥–¥–∞ –Ω–∞–æ–±–æ—Ä–æ—Ç!
- –ü—Ä–æ–≤–µ—Ä—å 5 —Å–ª–æ—ë–≤ –∏–ª–∏ –ø–æ–ª—É—á–∏—à—å –æ—à–∏–±–∫—É!

---

**–í–µ—Ä—Å–∏—è:** 1.2.0
**–î–∞—Ç–∞:** 28 –Ω–æ—è–±—Ä—è 2025
